{
  "db_name": "PostgreSQL",
  "query": "\nWITH selected_devices AS (\n    SELECT d.id FROM device d\n    JOIN release r ON d.release_id = r.id\n    LEFT JOIN device_network dn ON d.id = dn.device_id\n    WHERE d.last_ping > NOW() - INTERVAL '5 minutes'\n    AND d.release_id = d.target_release_id\n    AND r.distribution_id = $1\n    ORDER BY\n        COALESCE(dn.network_score, 0) DESC,\n        d.last_ping DESC\n    LIMIT 10\n)\nINSERT INTO deployment_devices (deployment_id, device_id)\nSELECT $2, id FROM selected_devices\n",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Int4",
        "Int4"
      ]
    },
    "nullable": []
  },
  "hash": "dbd76b39183406888b28eacbf20eac0f189a55dc77b9b957fd3e92c5e085e302"
}
